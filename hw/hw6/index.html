<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Jokebook</title>
    <style>
        body { font-family: Arial, sans-serif; }
        .category { cursor: pointer; color: blue; }
    </style>
</head>
<body>
    <h1>Jokebook</h1>
    <section id="random-joke">
        <h2>Random Joke</h2>
        <p id="joke-display">Click a category to view a joke!</p>
    </section>

    <section id="categories">
        <h2>Categories</h2>
        <div id="category-list"></div>
    </section>

    <section id="new-joke">
        <h2>Add a New Joke</h2>
        <form id="jokeForm">
            <input type="text" id="category" placeholder="Category" required />
            <input type="text" id="setup" placeholder="Setup" required />
            <input type="text" id="delivery" placeholder="Delivery" required />
            <button type="submit">Add Joke</button>
        </form>
    </section>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            fetch('/jokebook/categories')
                .then(response => response.json())
                .then(categories => {
                    const categoryList = document.getElementById('category-list');
                    categories.forEach(category => {
                        const catEl = document.createElement('p');
                        catEl.textContent = category.name;
                        catEl.className = 'category';
                        catEl.onclick = () => fetchJokesByCategory(category.name);
                        categoryList.appendChild(catEl);
                    });
                });
        });

        function fetchJokesByCategory(category) {
            fetch(`/jokebook/joke/${category}?limit=1`)
                .then(response => response.json())
                .then(jokes => {
                    const jokeDisplay = document.getElementById('joke-display');
                    jokeDisplay.textContent = jokes.length
                        ? `${jokes[0].setup} - ${jokes[0].delivery}`
                        : 'No jokes found.';
                });
        }

        document.getElementById('jokeForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const category = document.getElementById('category').value;
            const setup = document.getElementById('setup').value;
            const delivery = document.getElementById('delivery').value;

            fetch('/jokebook/joke/new', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ category, setup, delivery })
            })
            .then(response => response.json())
            .then(data => {
                fetchJokesByCategory(category); 
            });
        });
    </script>
</body>
</html>
